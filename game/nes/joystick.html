<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>joystick</title>
</head>
<style>
.joystick-container {
    width: 300px;
    height: 300px;
    background: #666;
    border-radius: 50%;
    position: relative;
    touch-action: none;
    user-select: none;
}
.joystick-handle {
    width: 100px;
    height: 100px;
    background: #ff0000;
    border-radius: 50%;
    position: absolute;
    left: calc(50% - 50px);
    top: calc(50% - 50px);
}
</style>
<body>
    <div class="debug-info" id="debug">方向：未激活</div>
    <div  class="joystick-container" id="joystick">
        <div class="joystick-handle" id="handle"></div>
    </div>
<script>
const joystick = document.getElementById('joystick');
const handle = document.getElementById('handle');
const debug = document.getElementById('debug');
let isDragging = false;
const radius = joystick.offsetWidth / 2; // 摇杆半径
// 方向角度定义（8个方向）
const directions = [
    { name: 'right', min: 0, max: 22.5 },
    { name: 'right', min: 337.5, max: 360 },
    { name: 'rightup', min: 22.5, max: 67.5 },
    { name: 'up', min: 67.5, max: 112.5 },
    { name: 'leftup', min: 112.5, max: 157.5 },
    { name: 'left', min: 157.5, max: 202.5 },
    { name: 'leftdown', min: 202.5, max: 247.5 },
    { name: 'down', min: 247.5, max: 292.5 },
    { name: 'rightdown', min: 292.5, max: 337.5 }
];
// 触摸/鼠标事件处理
function startDrag(e) {
    isDragging = true;
    handle.style.transition = 'none'; // 禁用过渡动画
    updatePosition(e);
}
function endDrag() {
    isDragging = false;
    handle.style.transition = 'all 0.3s ease'; // 复位动画
    handle.style.transform = `translate(0, 0)`;
    debug.textContent = "方向：未激活";
}
function updatePosition(e) {
    if (!isDragging) return;
    // 获取触摸/鼠标坐标
    const rect = joystick.getBoundingClientRect();
    var index,clientX,clientY
    if(e.touches){
        let arr=[]
        for(let i=0;i<e.touches.length;i++){
            let x = e.touches[i].clientX - rect.left - radius;
            let y = e.touches[i].clientY - rect.top - radius;
            arr[i] = Math.sqrt(x * x + y * y);
            index=arr.indexOf(Math.min(...arr))
        }
        clientX=e.touches[index].clientX;
        clientY=e.touches[index].clientY;
    }else{
        clientX=e.clientX;
        clientY=e.clientY;
    }
    // 计算相对位置
    let x = clientX - rect.left - radius;
    let y = clientY - rect.top - radius;
    // 限制摇杆移动范围
    const distance = Math.sqrt(x * x + y * y);
    if (distance > radius) {
        x = x / distance * radius;
        y = y / distance * radius;
    }
    // 更新摇杆位置
    handle.style.transform = `translate(${x}px, ${y}px)`;
    // 计算角度（0-360度）
    const angle = (Math.atan2(-y, x) * 180 / Math.PI + 360) % 360;
    // 检测方向
    const direction = directions.find(d => angle >= d.min && angle < d.max);
    debug.textContent =direction.name;
}
// 事件监听器
joystick.addEventListener('touchstart', startDrag);
joystick.addEventListener('touchmove', updatePosition);
joystick.addEventListener('touchend', endDrag);
</script>
</body>
</html>